{% extends "reports/report_template.html" %}
{% load humanize %}

{% block report_content %}
<div class="report-title">
    <span style="font-size: 10pt; font-weight: normal;">Fiscal Year: {{ fiscal_year }}</span>
</div>

<div class="meta-info">
    <strong>Generated By:</strong> {{ generated_by }} <br>
    <strong>Date Generated:</strong> {{ date_generated }}
</div>

<h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 11pt;">Budget Utilization by Category</h3>

<table class="data-table">
    <thead>
        <tr>
            <th style="width: 30%; text-align: left;">Category</th>
            <th style="width: 20%;">Allocated Budget</th>
            <th style="width: 20%;">Total Utilized</th>
            <th style="width: 20%;">Remaining Balance</th>
            <th style="width: 10%;">% Utilized</th>
        </tr>
    </thead>
    <tbody>
        {% for row in report_data %}
        <tr>
            <td style="text-align: left;"><strong>{{ row.category }}</strong></td>
            <td style="text-align: right;">Php {{ row.allocated|floatformat:2|intcomma }}</td>
            <td style="text-align: right;">Php {{ row.utilized|floatformat:2|intcomma }}</td>
            <td style="text-align: right;">Php {{ row.balance|floatformat:2|intcomma }}</td>
            <td style="text-align: center;">{{ row.percent|floatformat:1 }}%</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">No budget data found for this fiscal year.</td>
        </tr>
        {% endfor %}
        
        <!-- Total Row -->
        <tr class="total-row">
            <td style="text-align: right;">TOTAL</td>
            <td style="text-align: right;">Php {{ total_allocated|floatformat:2|intcomma }}</td>
            <td style="text-align: right;">Php {{ total_utilized|floatformat:2|intcomma }}</td>
            <td style="text-align: right;">Php {{ total_balance|floatformat:2|intcomma }}</td>
            <td style="text-align: center;">{{ total_util_percent|floatformat:1 }}%</td>
        </tr>
    </tbody>
</table>

<div class="notes">
    <strong>Summary Notes:</strong>
    <ul>
        <li>This report groups budget allocations by category (e.g., Office Supplies, Travelling Expenses).</li>
        <li>"Total Utilized" includes both Actual Expenses (Consumed) and Pending Commitments (Reserved).</li>
        <li>"Remaining Balance" is the amount available for future requests.</li>
    </ul>
</div>
{% endblock report_content %}
