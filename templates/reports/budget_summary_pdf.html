{% extends "reports/report_template.html" %}
{% load humanize %}

{% block report_content %}
<style>
    .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 11px;
    }
    .summary-table th, .summary-table td {
        border: 1px solid #000;
        padding: 5px;
        text-align: left;
    }
    .summary-table th {
        background-color: #f0f0f0;
        font-weight: bold;
        text-align: center;
    }
    .text-right { text-align: right; }
    .text-center { text-align: center; }
    .total-row { font-weight: bold; background-color: #e6e6e6; }
</style>

<div style="margin-bottom: 20px;">
    <p><strong>Fiscal Year:</strong> {{ fiscal_year }}</p>
    <p><strong>Generated By:</strong> {{ generated_by }}</p>
    <p><strong>Date Generated:</strong> {{ date_generated }}</p>
</div>

<h3>Budget Allocations Summary</h3>

<table class="summary-table">
    <thead>
        <tr>
            <th width="30%">Budget Line Item</th>
            <th width="15%">Allocated Budget</th>
            <th width="15%">Utilized (PR)</th>
            <th width="15%">Utilized (AD)</th>
            <th width="15%">Total Utilized</th>
            <th width="10%">Remaining Balance</th>
        </tr>
    </thead>
    <tbody>
        {% for allocation in budget_data %}
        <tr>
            <td>
                <strong>{{ allocation.approved_budget.title }}</strong><br>
                <span style="font-size: 9px; font-style: italic;">{{ allocation.department }}</span>
            </td>
            <td class="text-right">Php {{ allocation.allocated_amount|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ allocation.pr_amount_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ allocation.ad_amount_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ allocation.total_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ allocation.remaining_balance|floatformat:2|intcomma }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">No active budget allocations found for this fiscal year.</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr class="total-row">
            <td class="text-center">TOTAL</td>
            <td class="text-right">Php {{ total_allocated|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ total_pr_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ total_ad_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ grand_total_used|floatformat:2|intcomma }}</td>
            <td class="text-right">Php {{ total_remaining|floatformat:2|intcomma }}</td>
        </tr>
    </tfoot>
</table>

<div style="margin-top: 40px;">
    <p><strong>Summary Notes:</strong></p>
    <ul>
        <li>This report summarizes the current status of budget allocations assigned to your department.</li>
        <li>"Utilized (PR)" includes all Purchase Requests that are Approved or In-Process (reserved).</li>
        <li>"Utilized (AD)" includes all Activity Designs that are Approved or In-Process.</li>
    </ul>
</div>
{% endblock %}
