# Generated by Django 5.2.8 on 2025-12-03 11:01

import apps.budgets.models
import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='PRECategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('category_type', models.CharField(choices=[('PERSONNEL', 'Personnel Services'), ('MOOE', 'Maintenance and Other Operating Expenses'), ('CAPITAL', 'Capital Outlays')], max_length=20)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('is_active', models.BooleanField(default=True)),
                ('sort_order', models.IntegerField(default=0)),
            ],
            options={
                'verbose_name': 'PRE Category',
                'verbose_name_plural': 'PRE Categories',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ActivityDesign',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('ad_number', models.CharField(blank=True, max_length=50, unique=True)),
                ('department', models.CharField(max_length=255)),
                ('activity_title', models.CharField(blank=True, max_length=255)),
                ('activity_description', models.TextField(blank=True)),
                ('purpose', models.TextField(blank=True, help_text='Purpose/justification for this activity')),
                ('total_amount', models.DecimalField(decimal_places=6, max_digits=15)),
                ('uploaded_document', models.FileField(help_text='Upload Activity Design document (.docx format)', upload_to='ad_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['docx', 'doc'])])),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Pending', 'Pending Review'), ('Partially Approved', 'Partially Approved'), ('Awaiting Admin Verification', 'Awaiting Admin Verification'), ('Approved', 'Approved'), ('Rejected', 'Rejected')], default='Draft', max_length=50)),
                ('original_ad_pdf', models.FileField(blank=True, help_text='Original AD document (converted to PDF if uploaded as DOCX)', null=True, upload_to='ad/original_pdfs/')),
                ('partially_approved_pdf', models.FileField(blank=True, help_text='Auto-generated PDF when admin partially approves', null=True, upload_to='ad/partially_approved_pdfs/')),
                ('approved_documents', models.FileField(blank=True, help_text='Scanned signed copy uploaded by admin (DEPRECATED - use signed_approved_documents)', null=True, upload_to='ad/approved_documents/')),
                ('final_approved_scan', models.FileField(blank=True, help_text='Scanned copy of signed AD (DEPRECATED)', null=True, upload_to='ad_scanned/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('awaiting_verification', models.BooleanField(default=False, help_text='True when AD is awaiting admin verification of signed documents')),
                ('end_user_uploaded_at', models.DateTimeField(blank=True, help_text='When end user uploaded signed documents', null=True)),
                ('admin_approved_at', models.DateTimeField(blank=True, help_text='When admin gave final approval', null=True)),
                ('is_valid', models.BooleanField(default=False)),
                ('validation_errors', models.JSONField(blank=True, default=dict)),
                ('admin_notes', models.TextField(blank=True, help_text='Admin notes during review')),
                ('rejection_reason', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('partially_approved_at', models.DateTimeField(blank=True, null=True)),
                ('final_approved_at', models.DateTimeField(blank=True, null=True)),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archive_type', models.CharField(blank=True, choices=[('FISCAL_YEAR', 'Fiscal Year Archive'), ('MANUAL', 'Manual Archive/Delete')], default='FISCAL_YEAR', max_length=20)),
                ('admin_approved_by', models.ForeignKey(blank=True, help_text='Admin who gave final approval', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ad_final_approvals', to=settings.AUTH_USER_MODEL)),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_activity_designs', to=settings.AUTH_USER_MODEL)),
                ('submitted_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_designs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Activity Design',
                'verbose_name_plural': 'Activity Designs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ActivityDesignApprovedDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Signed/approved document (PDF or image scan)', upload_to='ad_approved_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(editable=False, help_text='File size in bytes')),
                ('document_type', models.CharField(choices=[('signed_ad', 'Signed AD Document'), ('signed_supporting', 'Signed Supporting Document')], default='signed_ad', help_text='Type of approved document', max_length=50)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.TextField(blank=True, help_text='Optional description or notes')),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF version for preview (image files)', null=True, upload_to='ad_approved_docs_pdf/%Y/%m/')),
                ('activity_design', models.ForeignKey(help_text='Link to AD submission', on_delete=django.db.models.deletion.CASCADE, related_name='signed_approved_documents', to='budgets.activitydesign')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='End user who uploaded this document', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='uploaded_ad_approved_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'AD Approved Document',
                'verbose_name_plural': 'AD Approved Documents',
                'db_table': 'activity_design_approved_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ActivityDesignSupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document file', upload_to='ad_supporting_docs/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('is_signed_copy', models.BooleanField(default=False, help_text='True if this is the signed version uploaded by admin')),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF version for preview (Excel/Word files)', null=True, upload_to='ad_supporting_docs_pdf/%Y/%m/')),
                ('activity_design', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.activitydesign')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='User who uploaded this document (admin for signed copies)', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'activity_design_supporting_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ADDraft',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ad_file', models.FileField(blank=True, help_text='Uploaded Activity Design document (.docx format only)', null=True, upload_to='ad_drafts/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['docx', 'doc'])])),
                ('ad_filename', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_submitted', models.BooleanField(default=False)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='ad_draft', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'AD Draft',
                'verbose_name_plural': 'AD Drafts',
                'db_table': 'ad_drafts',
            },
        ),
        migrations.CreateModel(
            name='ADDraftSupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document', upload_to='ad_draft_supporting/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('draft', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.addraft')),
            ],
            options={
                'db_table': 'ad_draft_supporting_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ApprovedBudget',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('fiscal_year', models.CharField(max_length=10)),
                ('amount', models.DecimalField(decimal_places=6, max_digits=15)),
                ('remaining_budget', models.DecimalField(decimal_places=6, max_digits=15)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archive_type', models.CharField(blank=True, choices=[('FISCAL_YEAR', 'Fiscal Year Archive'), ('MANUAL', 'Manual Archive/Delete')], default='FISCAL_YEAR', max_length=20)),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_approved_budgets', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Approved Budget',
                'verbose_name_plural': 'Approved Budgets',
                'ordering': ['-created_at'],
                'unique_together': {('fiscal_year',)},
            },
        ),
        migrations.CreateModel(
            name='BudgetAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('department', models.CharField(max_length=255)),
                ('allocated_amount', models.DecimalField(decimal_places=6, max_digits=15)),
                ('remaining_balance', models.DecimalField(decimal_places=6, max_digits=15)),
                ('pre_amount_used', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('pr_amount_used', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('ad_amount_used', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('allocated_at', models.DateTimeField(auto_now_add=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archive_type', models.CharField(blank=True, choices=[('FISCAL_YEAR', 'Fiscal Year Archive'), ('MANUAL', 'Manual Archive/Delete')], default='FISCAL_YEAR', max_length=20)),
                ('approved_budget', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='allocations', to='budgets.approvedbudget')),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_budget_allocations', to=settings.AUTH_USER_MODEL)),
                ('end_user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='budget_allocations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Budget Allocation',
                'verbose_name_plural': 'Budget Allocations',
                'ordering': ['department', 'end_user'],
                'unique_together': {('approved_budget', 'end_user')},
            },
        ),
        migrations.AddField(
            model_name='activitydesign',
            name='budget_allocation',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_designs', to='budgets.budgetallocation'),
        ),
        migrations.CreateModel(
            name='BudgetSavings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fiscal_year', models.CharField(help_text='Fiscal year of the savings', max_length=10)),
                ('department', models.CharField(help_text='Department name', max_length=255)),
                ('allocated_amount', models.DecimalField(decimal_places=2, help_text='Total amount allocated to department', max_digits=15)),
                ('pr_used', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Amount used by Purchase Requests', max_digits=15)),
                ('ad_used', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Amount used by Activity Designs', max_digits=15)),
                ('total_used', models.DecimalField(decimal_places=2, help_text='Total amount used (PR + AD)', max_digits=15)),
                ('savings_amount', models.DecimalField(decimal_places=2, help_text='Savings amount (Allocated - Used)', max_digits=15)),
                ('snapshot_date', models.DateTimeField(auto_now_add=True, help_text='When this snapshot was created')),
                ('quarter', models.CharField(blank=True, help_text='Q1, Q2, Q3, Q4, or Full Year', max_length=10)),
                ('notes', models.TextField(blank=True, help_text='Optional notes about this savings snapshot')),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_budget_savings', to=settings.AUTH_USER_MODEL)),
                ('budget_allocation', models.ForeignKey(help_text='Link to the budget allocation', on_delete=django.db.models.deletion.CASCADE, related_name='savings_snapshots', to='budgets.budgetallocation')),
                ('created_by', models.ForeignKey(blank=True, help_text='Admin who created this snapshot', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_savings_snapshots', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Budget Savings',
                'verbose_name_plural': 'Budget Savings',
                'ordering': ['-snapshot_date'],
            },
        ),
        migrations.CreateModel(
            name='BudgetTransactionLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_type', models.CharField(choices=[('PRE_APPROVED', 'PRE Approved'), ('PR_APPROVED', 'Purchase Request Approved'), ('AD_APPROVED', 'Activity Design Approved'), ('PRE_REJECTED', 'PRE Rejected'), ('PR_REJECTED', 'Purchase Request Rejected'), ('AD_REJECTED', 'Activity Design Rejected'), ('ALLOCATION_CREATED', 'Allocation Created'), ('ALLOCATION_MODIFIED', 'Allocation Modified'), ('ALLOCATION_DELETED', 'Allocation Deleted'), ('REALIGNMENT_APPROVED', 'Budget Realignment Approved')], help_text='Type of transaction that caused the balance change', max_length=30)),
                ('amount_change', models.DecimalField(decimal_places=2, help_text='Amount added (positive) or deducted (negative) from budget', max_digits=12)),
                ('previous_balance', models.DecimalField(decimal_places=2, help_text='Balance before this transaction', max_digits=12)),
                ('new_balance', models.DecimalField(decimal_places=2, help_text='Balance after this transaction', max_digits=12)),
                ('related_document_type', models.CharField(blank=True, help_text='Type of related document (PRE, PR, AD, etc.)', max_length=20, null=True)),
                ('related_document_id', models.CharField(blank=True, help_text='ID or number of the related document', max_length=100, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When this transaction occurred')),
                ('notes', models.TextField(blank=True, help_text='Additional notes or context about this transaction')),
                ('allocation', models.ForeignKey(help_text='The budget allocation affected by this transaction', on_delete=django.db.models.deletion.CASCADE, related_name='transaction_logs', to='budgets.budgetallocation')),
                ('created_by', models.ForeignKey(blank=True, help_text='User who triggered this transaction', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Budget Transaction Log',
                'verbose_name_plural': 'Budget Transaction Logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DepartmentPRE',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('department', models.CharField(max_length=255)),
                ('program', models.CharField(blank=True, max_length=255, null=True)),
                ('fund_source', models.CharField(blank=True, max_length=100, null=True)),
                ('fiscal_year', models.CharField(max_length=10)),
                ('uploaded_excel_file', models.FileField(blank=True, help_text='Upload PRE Excel file', null=True, upload_to='pre_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['xlsx', 'xls'])])),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Pending', 'Pending Review'), ('Partially Approved', 'Partially Approved'), ('Awaiting Admin Verification', 'Awaiting Admin Verification'), ('Approved', 'Approved'), ('Rejected', 'Rejected')], default='Draft', max_length=30)),
                ('is_valid', models.BooleanField(default=False)),
                ('validation_errors', models.JSONField(blank=True, default=dict)),
                ('total_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('partially_approved_pdf', models.FileField(blank=True, help_text='PDF generated from database when partially approved (includes custom line items)', null=True, upload_to='pre_pdfs/%Y/%m/')),
                ('original_excel_pdf', models.FileField(blank=True, help_text='PDF converted from original uploaded Excel file (preserved snapshot)', null=True, upload_to='pre_pdfs/%Y/%m/')),
                ('final_approved_scan', models.FileField(blank=True, help_text='Scanned copy of signed printed PRE', null=True, upload_to='pre_scanned/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('prepared_by_name', models.CharField(blank=True, max_length=255)),
                ('certified_by_name', models.CharField(blank=True, max_length=255)),
                ('approved_by_name', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin_notes', models.TextField(blank=True, help_text='Admin notes during review')),
                ('rejection_reason', models.TextField(blank=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('partially_approved_at', models.DateTimeField(blank=True, null=True)),
                ('final_approved_at', models.DateTimeField(blank=True, null=True)),
                ('awaiting_verification', models.BooleanField(default=False, help_text='True when end user has uploaded signed documents, awaiting admin verification')),
                ('end_user_uploaded_at', models.DateTimeField(blank=True, help_text='Timestamp when end user uploaded signed documents', null=True)),
                ('approved_documents', models.FileField(blank=True, help_text='Scanned approved documents uploaded by admin', null=True, upload_to='pre_approved_docs/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png', 'doc', 'docx'])])),
                ('admin_approved_at', models.DateTimeField(blank=True, help_text='Timestamp when admin uploaded approved documents', null=True)),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archive_type', models.CharField(blank=True, choices=[('FISCAL_YEAR', 'Fiscal Year Archive'), ('MANUAL', 'Manual Archive/Delete')], default='FISCAL_YEAR', max_length=20)),
                ('admin_approved_by', models.ForeignKey(blank=True, help_text='Admin who uploaded the approved documents', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='admin_approved_pres', to=settings.AUTH_USER_MODEL)),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_department_pres', to=settings.AUTH_USER_MODEL)),
                ('budget_allocation', models.ForeignKey(help_text='Must be linked to specific budget allocation', on_delete=django.db.models.deletion.CASCADE, related_name='pres', to='budgets.budgetallocation')),
                ('submitted_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='submitted_pres', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Department PRE',
                'verbose_name_plural': 'Department PREs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DepartmentPREApprovedDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Signed/approved document (PDF or image scan)', upload_to='pre_approved_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(editable=False, help_text='File size in bytes')),
                ('document_type', models.CharField(choices=[('signed_pre', 'Signed PRE Document'), ('signed_supporting', 'Signed Supporting Document')], default='signed_pre', help_text='Type of approved document', max_length=50)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.TextField(blank=True, help_text='Optional description or notes')),
                ('pre', models.ForeignKey(help_text='Link to PRE submission', on_delete=django.db.models.deletion.CASCADE, related_name='signed_approved_documents', to='budgets.departmentpre')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='End user who uploaded this document', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='uploaded_pre_approved_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'PRE Approved Document',
                'verbose_name_plural': 'PRE Approved Documents',
                'db_table': 'department_pre_approved_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='DepartmentPRESupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document file (PDF, Word, Excel, Images)', upload_to='pre_supporting_docs/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'xlsx', 'xls', 'jpg', 'jpeg', 'png'])])),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(editable=False, help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.CharField(blank=True, help_text='Optional description of the document', max_length=500)),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF version for preview (Excel/Word files)', null=True, upload_to='pre_supporting_docs_pdf/%Y/%m/')),
                ('department_pre', models.ForeignKey(help_text='Link to PRE submission', on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.departmentpre')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='User who uploaded this document', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'PRE Supporting Document',
                'verbose_name_plural': 'PRE Supporting Documents',
                'db_table': 'department_pre_supporting_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='PRDraft',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('pr_file', models.FileField(blank=True, help_text='Uploaded PR document', null=True, upload_to='pr_drafts/%Y/%m/')),
                ('pr_filename', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_submitted', models.BooleanField(default=False)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='pr_draft', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'PR Draft',
                'verbose_name_plural': 'PR Drafts',
                'db_table': 'pr_drafts',
            },
        ),
        migrations.CreateModel(
            name='PRDraftSupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document', upload_to='pr_draft_supporting/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('draft', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.prdraft')),
            ],
            options={
                'db_table': 'pr_draft_supporting_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='PREBudgetRealignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Pending', 'Pending'), ('Partially Approved', 'Partially Approved'), ('Awaiting Admin Verification', 'Awaiting Admin Verification'), ('Approved', 'Approved'), ('Rejected', 'Rejected')], default='Pending', max_length=50)),
                ('reason', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('partially_approved_at', models.DateTimeField(blank=True, null=True)),
                ('final_approved_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by_approving_officer', models.BooleanField(blank=True, default=False, null=True)),
                ('approved_by_admin', models.BooleanField(blank=True, default=False, null=True)),
                ('admin_approved_at', models.DateTimeField(blank=True, null=True)),
                ('partially_approved_pdf', models.FileField(blank=True, help_text='PDF generated from uploaded documents when partially approved', null=True, upload_to='br_pdfs/%Y/%m/')),
                ('approved_documents', models.FileField(blank=True, help_text='Scanned approved documents uploaded by admin', null=True, upload_to='br_approved_docs/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('final_approved_scan', models.FileField(blank=True, help_text='Scanned copy of signed budget realignment', null=True, upload_to='br_scanned/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('end_user_uploaded_document', models.FileField(blank=True, help_text='Signed document uploaded by end user after partial approval', null=True, upload_to='br_end_user_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('end_user_uploaded_at', models.DateTimeField(blank=True, null=True)),
                ('admin_notes', models.TextField(blank=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('source_item_key', models.CharField(max_length=255)),
                ('source_quarter', models.CharField(blank=True, max_length=10, null=True)),
                ('target_item_key', models.CharField(max_length=255)),
                ('target_quarter', models.CharField(blank=True, max_length=10, null=True)),
                ('q1_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('q2_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('q3_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('q4_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('source_item_display', models.CharField(blank=True, max_length=500, null=True)),
                ('target_item_display', models.CharField(blank=True, max_length=500, null=True)),
                ('admin_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pre_realignment_admin_approvals', to=settings.AUTH_USER_MODEL)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pre_realignment_approvals', to=settings.AUTH_USER_MODEL)),
                ('partial_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pre_realignment_partial_approvals', to=settings.AUTH_USER_MODEL)),
                ('requested_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pre_realignment_requests', to=settings.AUTH_USER_MODEL)),
                ('source_pre', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='source_budget_realignments', to='budgets.departmentpre')),
                ('target_pre', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='target_budget_realignments', to='budgets.departmentpre')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='BudgetRealignmentSupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(upload_to='br_supporting_docs/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'xlsx', 'xls', 'jpg', 'jpeg', 'png'])])),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF for image/office document uploads', null=True, upload_to='br_converted_pdfs/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField()),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.CharField(blank=True, max_length=500)),
                ('is_signed_copy', models.BooleanField(default=False, help_text='Is this a signed/approved copy?')),
                ('uploaded_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('budget_realignment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.prebudgetrealignment')),
            ],
            options={
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='PRELineItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('item_name', models.CharField(max_length=255)),
                ('item_code', models.CharField(blank=True, max_length=50)),
                ('description', models.TextField(blank=True)),
                ('source_type', models.CharField(choices=[('excel', 'From Excel Template'), ('manual', 'Manually Added')], default='excel', max_length=20)),
                ('q1_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q2_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q3_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q4_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('is_procurable', models.BooleanField(default=False)),
                ('procurement_method', models.CharField(blank=True, max_length=100)),
                ('remarks', models.TextField(blank=True)),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='budgets.precategory')),
                ('pre', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='line_items', to='budgets.departmentpre')),
            ],
            options={
                'ordering': ['category__sort_order', 'subcategory__sort_order', 'item_name'],
            },
        ),
        migrations.CreateModel(
            name='ActivityDesignAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quarter', models.CharField(choices=[('Q1', 'Quarter 1'), ('Q2', 'Quarter 2'), ('Q3', 'Quarter 3'), ('Q4', 'Quarter 4')], help_text='Which quarter of the PRE line item is being used', max_length=2)),
                ('allocated_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), help_text='Amount allocated from this line item', max_digits=15)),
                ('allocated_at', models.DateTimeField(auto_now_add=True, help_text='When the allocation was made')),
                ('notes', models.TextField(blank=True, help_text='Optional notes about this allocation')),
                ('activity_design', models.ForeignKey(help_text='The activity design being funded', on_delete=django.db.models.deletion.CASCADE, related_name='pre_allocations', to='budgets.activitydesign')),
                ('pre_line_item', models.ForeignKey(help_text='The PRE line item providing the funds', on_delete=django.db.models.deletion.PROTECT, related_name='ad_allocations', to='budgets.prelineitem')),
            ],
            options={
                'verbose_name': 'Activity Design Allocation',
                'verbose_name_plural': 'Activity Design Allocations',
                'db_table': 'activity_design_allocations',
                'ordering': ['-allocated_at'],
            },
        ),
        migrations.CreateModel(
            name='PRELineItemSavings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('category', models.CharField(help_text='Budget category (Personnel/MOOE/Capital)', max_length=255)),
                ('subcategory', models.CharField(blank=True, help_text='Budget subcategory if applicable', max_length=255)),
                ('item_name', models.CharField(help_text='Name of the budget line item', max_length=255)),
                ('q1_allocated', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q1 allocated amount', max_digits=15)),
                ('q1_consumed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q1 consumed amount (PR + AD)', max_digits=15)),
                ('q1_surplus', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q1 unused/surplus amount', max_digits=15)),
                ('q2_allocated', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q2 allocated amount', max_digits=15)),
                ('q2_consumed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q2 consumed amount (PR + AD)', max_digits=15)),
                ('q2_surplus', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q2 unused/surplus amount', max_digits=15)),
                ('q3_allocated', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q3 allocated amount', max_digits=15)),
                ('q3_consumed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q3 consumed amount (PR + AD)', max_digits=15)),
                ('q3_surplus', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q3 unused/surplus amount', max_digits=15)),
                ('q4_allocated', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q4 allocated amount', max_digits=15)),
                ('q4_consumed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q4 consumed amount (PR + AD)', max_digits=15)),
                ('q4_surplus', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Q4 unused/surplus amount', max_digits=15)),
                ('total_allocated', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total allocated across all quarters', max_digits=15)),
                ('total_consumed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total consumed across all quarters', max_digits=15)),
                ('total_surplus', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total unused/surplus across all quarters', max_digits=15)),
                ('is_procurable', models.BooleanField(default=False, help_text='Whether this item requires procurement')),
                ('is_significant', models.BooleanField(default=False, help_text='True if surplus exceeds threshold (e.g., >â‚±5,000)')),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When this line item savings record was created')),
                ('budget_savings', models.ForeignKey(help_text='Parent savings snapshot', on_delete=django.db.models.deletion.CASCADE, related_name='line_item_breakdowns', to='budgets.budgetsavings')),
                ('pre_line_item', models.ForeignKey(blank=True, help_text='Original PRE line item (may be null if deleted)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='savings_records', to='budgets.prelineitem')),
            ],
            options={
                'verbose_name': 'PRE Line Item Savings',
                'verbose_name_plural': 'PRE Line Item Savings',
                'ordering': ['-total_surplus', 'category', 'item_name'],
            },
        ),
        migrations.CreateModel(
            name='PREReceipt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('receipt_type', models.CharField(max_length=100)),
                ('q1_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q2_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q3_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('q4_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('pre', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipts', to='budgets.departmentpre')),
            ],
        ),
        migrations.CreateModel(
            name='PRESubCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('code', models.CharField(max_length=50)),
                ('is_active', models.BooleanField(default=True)),
                ('sort_order', models.IntegerField(default=0)),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subcategories', to='budgets.precategory')),
            ],
            options={
                'verbose_name': 'PRE Sub-Category',
                'verbose_name_plural': 'PRE Sub-Categories',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.AddField(
            model_name='prelineitem',
            name='subcategory',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='budgets.presubcategory'),
        ),
        migrations.CreateModel(
            name='PurchaseRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('department', models.CharField(max_length=255)),
                ('pr_number', models.CharField(max_length=50, unique=True)),
                ('source_of_fund_display', models.CharField(blank=True, help_text='Human-readable source of fund description', max_length=500)),
                ('purpose', models.TextField()),
                ('total_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), max_digits=15)),
                ('entity_name', models.CharField(blank=True, max_length=255)),
                ('fund_cluster', models.CharField(blank=True, max_length=100)),
                ('office_section', models.CharField(blank=True, max_length=255)),
                ('responsibility_center_code', models.CharField(blank=True, max_length=100)),
                ('uploaded_document', models.FileField(blank=True, help_text='Uploaded PR document', null=True, upload_to='pr_documents/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['docx', 'doc', 'pdf'])])),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Pending', 'Pending Review'), ('Partially Approved', 'Partially Approved'), ('Awaiting Admin Verification', 'Awaiting Admin Verification'), ('Approved', 'Approved'), ('Rejected', 'Rejected')], default='Draft', max_length=50)),
                ('partially_approved_pdf', models.FileField(blank=True, help_text='Auto-generated PDF when admin partially approves', null=True, upload_to='pr/partially_approved_pdfs/')),
                ('approved_documents', models.FileField(blank=True, help_text='Scanned signed copy uploaded by admin', null=True, upload_to='pr/approved_documents/')),
                ('final_approved_scan', models.FileField(blank=True, help_text='Scanned copy of signed PR', null=True, upload_to='pr_scanned/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('is_valid', models.BooleanField(default=False)),
                ('validation_errors', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('partially_approved_at', models.DateTimeField(blank=True, help_text='When admin partially approved', null=True)),
                ('final_approved_at', models.DateTimeField(blank=True, help_text='When admin uploaded signed copy (full approval)', null=True)),
                ('admin_notes', models.TextField(blank=True, help_text='Admin notes when uploading signed copy')),
                ('rejection_reason', models.TextField(blank=True)),
                ('awaiting_verification', models.BooleanField(default=False, help_text='True when PR is awaiting admin verification of signed documents')),
                ('end_user_uploaded_at', models.DateTimeField(blank=True, help_text='When end user uploaded signed documents', null=True)),
                ('admin_approved_at', models.DateTimeField(blank=True, help_text='When admin gave final approval after verification', null=True)),
                ('original_pr_pdf', models.FileField(blank=True, help_text='PDF of original PR with BISU header (generated on partial approval)', null=True, upload_to='pr_original_pdfs/%Y/%m/')),
                ('is_archived', models.BooleanField(db_index=True, default=False)),
                ('archived_at', models.DateTimeField(blank=True, null=True)),
                ('archive_reason', models.TextField(blank=True)),
                ('archive_type', models.CharField(blank=True, choices=[('FISCAL_YEAR', 'Fiscal Year Archive'), ('MANUAL', 'Manual Archive/Delete')], default='FISCAL_YEAR', max_length=20)),
                ('admin_approved_by', models.ForeignKey(blank=True, help_text='Admin who gave final approval', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pr_final_approvals', to=settings.AUTH_USER_MODEL)),
                ('archived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='archived_purchase_requests', to=settings.AUTH_USER_MODEL)),
                ('budget_allocation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchase_requests', to='budgets.budgetallocation')),
                ('source_line_item', models.ForeignKey(blank=True, help_text='Specific PRE line item used for funding', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='purchase_requests', to='budgets.prelineitem')),
                ('source_pre', models.ForeignKey(blank=True, help_text='Source PRE document', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='purchase_requests', to='budgets.departmentpre')),
                ('submitted_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchase_requests', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Purchase Request',
                'verbose_name_plural': 'Purchase Requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseRequestAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quarter', models.CharField(choices=[('Q1', 'Quarter 1'), ('Q2', 'Quarter 2'), ('Q3', 'Quarter 3'), ('Q4', 'Quarter 4')], help_text='Which quarter of the PRE line item is being used', max_length=2)),
                ('allocated_amount', models.DecimalField(decimal_places=6, default=Decimal('0.00'), help_text='Amount allocated from this line item', max_digits=15)),
                ('allocated_at', models.DateTimeField(auto_now_add=True, help_text='When the allocation was made')),
                ('notes', models.TextField(blank=True, help_text='Optional notes about this allocation')),
                ('pre_line_item', models.ForeignKey(help_text='The PRE line item providing the funds', on_delete=django.db.models.deletion.PROTECT, related_name='pr_allocations', to='budgets.prelineitem')),
                ('purchase_request', models.ForeignKey(help_text='The purchase request being funded', on_delete=django.db.models.deletion.CASCADE, related_name='pre_allocations', to='budgets.purchaserequest')),
            ],
            options={
                'verbose_name': 'Purchase Request Allocation',
                'verbose_name_plural': 'Purchase Request Allocations',
                'db_table': 'purchase_request_allocations',
                'ordering': ['-allocated_at'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseRequestApprovedDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Signed/approved document (PDF or image scan)', upload_to='pr_approved_uploads/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])])),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(editable=False, help_text='File size in bytes')),
                ('document_type', models.CharField(choices=[('signed_pr', 'Signed PR Document'), ('signed_supporting', 'Signed Supporting Document')], default='signed_pr', help_text='Type of approved document', max_length=50)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.TextField(blank=True, help_text='Optional description or notes')),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF version for preview (image files)', null=True, upload_to='pr_approved_docs_pdf/%Y/%m/')),
                ('purchase_request', models.ForeignKey(help_text='Link to PR submission', on_delete=django.db.models.deletion.CASCADE, related_name='signed_approved_documents', to='budgets.purchaserequest')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='End user who uploaded this document', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='uploaded_pr_approved_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'PR Approved Document',
                'verbose_name_plural': 'PR Approved Documents',
                'db_table': 'purchase_request_approved_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseRequestItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('stock_property_no', models.CharField(blank=True, max_length=100)),
                ('unit', models.CharField(max_length=50)),
                ('item_description', models.TextField()),
                ('quantity', models.IntegerField()),
                ('unit_cost', models.DecimalField(decimal_places=2, max_digits=15)),
                ('total_cost', models.DecimalField(decimal_places=2, editable=False, max_digits=15)),
                ('purchase_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='budgets.purchaserequest')),
            ],
        ),
        migrations.CreateModel(
            name='PurchaseRequestSupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document file', upload_to='pr_supporting_docs/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_size', models.BigIntegerField(help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('is_signed_copy', models.BooleanField(default=False, help_text='True if this is the signed version uploaded by admin')),
                ('converted_pdf', models.FileField(blank=True, help_text='Auto-converted PDF version for preview (Excel/Word files)', null=True, upload_to='pr_supporting_docs_pdf/%Y/%m/')),
                ('purchase_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.purchaserequest')),
                ('uploaded_by', models.ForeignKey(blank=True, help_text='User who uploaded this document (admin for signed copies)', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'purchase_request_supporting_documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='RequestApproval',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('content_type', models.CharField(choices=[('pre', 'PRE'), ('pr', 'Purchase Request'), ('ad', 'Activity Design')], max_length=10)),
                ('object_id', models.UUIDField()),
                ('approval_level', models.CharField(max_length=50)),
                ('approved_at', models.DateTimeField(auto_now_add=True)),
                ('comments', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-approved_at'],
            },
        ),
        migrations.CreateModel(
            name='SupportingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(help_text='Supporting document (PDF, Word, Excel)', upload_to=apps.budgets.models.supporting_document_upload_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'xlsx', 'xls'])])),
                ('file_name', models.CharField(max_length=255)),
                ('file_format', models.CharField(editable=False, max_length=10)),
                ('file_size', models.BigIntegerField(editable=False, help_text='File size in bytes')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.CharField(blank=True, max_length=255)),
                ('approved_budget', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supporting_documents', to='budgets.approvedbudget')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Supporting Document',
                'verbose_name_plural': 'Supporting Documents',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='SystemNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('message', models.TextField()),
                ('content_type', models.CharField(choices=[('pre', 'PRE'), ('pr', 'Purchase Request'), ('ad', 'Activity Design')], max_length=10)),
                ('object_id', models.UUIDField()),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='budgetsavings',
            index=models.Index(fields=['fiscal_year', 'department'], name='budgets_bud_fiscal__35b76d_idx'),
        ),
        migrations.AddIndex(
            model_name='budgetsavings',
            index=models.Index(fields=['-snapshot_date'], name='budgets_bud_snapsho_30adf3_idx'),
        ),
        migrations.AddIndex(
            model_name='budgettransactionlog',
            index=models.Index(fields=['allocation', '-created_at'], name='budgets_bud_allocat_aefc28_idx'),
        ),
        migrations.AddIndex(
            model_name='budgettransactionlog',
            index=models.Index(fields=['transaction_type', '-created_at'], name='budgets_bud_transac_90686b_idx'),
        ),
        migrations.AddIndex(
            model_name='budgettransactionlog',
            index=models.Index(fields=['-created_at'], name='budgets_bud_created_424502_idx'),
        ),
        migrations.AddIndex(
            model_name='activitydesignallocation',
            index=models.Index(fields=['activity_design', 'pre_line_item'], name='activity_de_activit_62ab0c_idx'),
        ),
        migrations.AddIndex(
            model_name='prelineitemsavings',
            index=models.Index(fields=['budget_savings', 'category'], name='budgets_pre_budget__bc57f0_idx'),
        ),
        migrations.AddIndex(
            model_name='prelineitemsavings',
            index=models.Index(fields=['-total_surplus'], name='budgets_pre_total_s_626d95_idx'),
        ),
        migrations.AddIndex(
            model_name='prelineitemsavings',
            index=models.Index(fields=['is_significant'], name='budgets_pre_is_sign_b6f0b5_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='presubcategory',
            unique_together={('category', 'code')},
        ),
        migrations.AddIndex(
            model_name='purchaserequestallocation',
            index=models.Index(fields=['purchase_request', 'pre_line_item'], name='purchase_re_purchas_75feec_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='requestapproval',
            unique_together={('content_type', 'object_id', 'approved_by', 'approval_level')},
        ),
    ]
